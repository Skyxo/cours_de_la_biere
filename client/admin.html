<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:,">
  <title>Wall Street Bar – Interface Administrateur</title>
  <!-- Bootstrap 5 CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- Custom styles -->
  <link rel="stylesheet" href="style.css">
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    /* Grid for drink management (desktop default) */
    .drinks-form-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr auto;
      gap: 10px;
      align-items: end;
    }
    
    .drinks-table-container {
      border: 1px solid rgba(var(--accent), 0.3);
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .drinks-header-toggle {
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      user-select: none;
      transition: all 0.2s ease;
    }
    
    .drinks-header-toggle:hover {
      background: rgba(var(--accent), 0.1);
      border-radius: 6px;
      padding: 10px;
      margin: 0 -10px;
    }
    
    .toggle-icon {
      font-size: 1.2em;
      transition: transform 0.3s ease;
    }
    
    /* Styles pour les sections accordéon */
    .accordion-container {
      max-width: 1200px;
      margin: 20px auto;
    }
    
    .admin-section {
      background: rgba(var(--surface), 0.85);
      border: 2px solid rgb(var(--accent));
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(var(--accent), 0.15);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .admin-section:hover {
      box-shadow: 0 6px 25px rgba(var(--accent), 0.25);
      transform: translateY(-2px);
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 25px;
      background: rgba(var(--accent), 0.1);
      cursor: pointer;
      user-select: none;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(var(--accent), 0.2);
    }
    
    .section-header:hover {
      background: rgba(var(--accent), 0.15);
    }
    
    .section-header h3 {
      margin: 0;
      color: rgb(var(--accent));
      font-weight: 600;
      font-size: 1.2em;
    }
    
    .section-content {
      padding: 25px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.4s ease;
      opacity: 0;
    }
    
    .section-content.active {
      max-height: 2000px; /* Augmenté pour permettre plus de contenu */
      opacity: 1;
      padding: 25px;
    }
    
    .section-header .toggle-icon {
      font-size: 1.4em;
      color: rgb(var(--accent));
      transition: transform 0.3s ease;
    }
    
    .section-header .toggle-icon.rotated {
      transform: rotate(180deg);
    }
    
    /* Container pour les tableaux sans scroll fixe */
    .table-container {
      max-height: none;
      overflow: visible;
    }
    
    /* Styles spécifiques pour la section "Enregistrer un achat" */
    #purchase-section .table-responsive {
      max-height: 500px; /* Hauteur maximale pour la table des achats */
      overflow-y: auto; /* Scroll vertical si nécessaire */
      border: 1px solid rgba(var(--accent), 0.2);
      border-radius: 8px;
    }
    
    #purchase-table {
      margin-bottom: 0;
    }
    
    #purchase-table thead th {
      position: sticky;
      top: 0;
      background: rgba(var(--accent), 0.15);
      z-index: 10;
      padding: 12px 8px;
      border-bottom: 2px solid rgba(var(--accent), 0.3);
    }
    
    /* Styles pour la colonne prix min/max */
    .price-range {
      display: flex;
      flex-direction: column;
      font-size: 0.85em;
      line-height: 1.2;
    }
    
    .min-price {
      color: rgb(var(--up));
      font-weight: bold;
    }
    
    .max-price {
      color: rgb(var(--down));
      font-weight: bold;
    }
    
    .alcohol-degree {
      color: rgb(var(--accent));
      font-size: 0.75em;
      font-weight: normal;
      margin-left: 4px;
      text-shadow: 0 0 5px rgba(var(--accent), 0.6);
      opacity: 0.9;
    }
    
    /* Styles spécifiques pour la section "Historique des transactions" */
    #history-section .table-container {
      max-height: 300px; /* Réduit de 600px à 300px */
      overflow-y: auto; /* Scroll vertical si nécessaire */
      border: 1px solid rgba(var(--accent), 0.2);
      border-radius: 8px;
      margin-top: 15px;
    }
    
    #history-table {
      margin-bottom: 0;
    }
    
    #history-table thead th {
      position: sticky;
      top: 0;
      background: rgba(var(--accent), 0.15);
      z-index: 10;
      padding: 12px 8px;
      border-bottom: 2px solid rgba(var(--accent), 0.3);
    }
    
    /* Styles spécifiques pour la section "Liste des boissons existantes" */
    #drinks-table-content {
      max-height: 500px; /* Hauteur maximale pour la liste des boissons */
      overflow-y: auto; /* Scroll vertical si nécessaire */
      border: 1px solid rgba(var(--accent), 0.2);
      border-radius: 8px;
      margin-top: 10px;
    }
    
    /* Amélioration des formulaires dans les sections */
    .section-content .form-group {
      margin-bottom: 20px;
    }
    
    .section-content .btn {
      margin-top: 10px;
    }
    
    /* Responsive pour mobile */
    @media (max-width: 768px) {
      .accordion-container {
        margin: 10px;
      }
      
      .admin-section {
        margin-bottom: 15px;
      }
      
      .section-header {
        padding: 15px 20px;
      }
      
      .section-content {
        padding: 20px;
      }
      
      .section-content.active {
        padding: 20px;
      }
      
      .drinks-form-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
    }
    
    .toggle-icon {
      font-size: 1.2em;
      color: rgb(var(--accent));
      transition: transform 0.3s ease;
      margin-right: 10px;
    }
    
    .toggle-icon.rotated {
      transform: rotate(180deg);
    }
    
    .drinks-existing-section {
      margin-top: 20px;
    }
    
    .drinks-table-header {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto;
      gap: 10px;
      background: rgba(var(--accent), 0.15);
      backdrop-filter: blur(10px); /* Effet de flou derrière */
      -webkit-backdrop-filter: blur(10px); /* Safari */
      padding: 12px 10px;
      font-weight: bold;
      color: rgb(var(--accent));
      font-size: 0.9em;
      position: sticky;
      top: 0;
      z-index: 100; /* Z-index très élevé */
      border-bottom: 2px solid rgba(var(--accent), 0.3);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Ombre pour séparer visuellement */
    }
    
    .drinks-table-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto;
      gap: 10px;
      padding: 10px;
      border-bottom: 1px solid rgba(var(--accent), 0.1);
      align-items: center;
    }
    
    .drinks-table-row:last-child {
      border-bottom: none;
    }
    
    .drinks-table-row input {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid rgba(var(--accent), 0.3);
      border-radius: 4px;
      background: rgba(var(--surface), 0.8);
      color: inherit;
    }
    .admin-header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(var(--accent), 0.12);
      border-radius: 10px;
      border: 2px solid rgb(var(--accent));
    }
    
    .admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .admin-card {
      background: rgba(var(--surface), 0.85);
      border: 2px solid rgb(var(--accent));
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(var(--accent), 0.35);
    }
    
    .admin-card h3 {
      color: rgb(var(--title));
      margin-top: 0;
      text-align: center;
      border-bottom: 1px solid rgba(var(--grid), 0.6);
      padding-bottom: 10px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: rgb(var(--accent));
      font-weight: bold;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      background: rgba(var(--surface), 0.5);
      border: 1px solid rgba(var(--grid), 0.6);
      border-radius: 5px;
      color: rgb(var(--text));
      font-size: 1em;
    }
    
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: rgb(var(--accent));
      box-shadow: 0 0 10px rgba(var(--accent), 0.35);
    }
    
    .btn {
      background: linear-gradient(45deg, rgb(var(--accent)), rgba(var(--danger), 0.9));
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
      transition: all 0.3s ease;
      margin: 5px;
    }
    /* Petits boutons icônes (trash) */
    .btn-icon {
      padding: 6px 10px;
      border-radius: 10px;
      font-size: 0.95em;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      min-height: 32px;
    }
    
    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
    }
    
    .btn-danger {
      background: linear-gradient(45deg, rgb(var(--danger)), #B71C1C);
      color: #fff;
    }
    
    .btn-warning {
      background: linear-gradient(45deg, #FFA726, #FB8C00);
    }
    
    /* Animation pour les boutons maximaux */
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(255, 255, 255, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
      }
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: rgba(var(--accent), 0.12);
      border: 1px solid rgb(var(--accent));
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: rgb(var(--accent));
    }
    
    .stat-label {
      color: #888;
      font-size: 0.9em;
    }
    
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    .history-table th, .history-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid rgba(var(--grid), 0.6);
    }
    
    .history-table th {
      background: rgba(var(--accent), 0.18);
      color: rgb(var(--th-text));
    }
    
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-connected { background: rgb(var(--accent)); }
    .status-disconnected { background: rgb(var(--danger)); }
    
    .price-input {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .price-input input {
      flex: 1;
    }
    
    .price-prediction {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }
    
    .current-price {
      color: rgb(var(--accent));
      font-weight: bold;
      font-size: 1.1em;
    }
    
    .next-price {
      color: #888;
      font-size: 0.85em;
    }
    
    .next-price.increase {
      color: #4CAF50;
    }
    
    .next-price.decrease {
      color: #ff4444;
    }
    
    .price-arrow {
      color: #888;
      font-size: 0.8em;
      margin: 0 4px;
    }
    
    .price-arrow.price-increase {
      color: #4CAF50;
    }
    
    .price-arrow.price-decrease {
      color: #ff4444;
    }
    
    .price-arrow.price-stable {
      color: #888;
    }
    
    .timer-section {
      background: rgba(var(--accent), 0.1);
      border: 1px solid rgba(var(--accent), 0.3);
      border-radius: 6px;
      padding: 8px 12px;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .timer-display {
      color: rgb(var(--accent));
      font-weight: bold;
      font-size: 1.1em;
    }
    
    .message {
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
    }
    
    .message.success {
      background: rgba(var(--accent), 0.18);
      color: rgb(var(--accent));
      border: 1px solid rgb(var(--accent));
    }
    
    .message.error {
      background: rgba(var(--danger), 0.18);
      color: rgb(var(--danger));
      border: 1px solid rgb(var(--danger));
    }
    
    .auth-form {
      max-width: 400px;
      margin: 100px auto;
      padding: 30px;
      background: rgba(var(--surface), 0.95);
      border: 2px solid rgb(var(--accent));
      border-radius: 10px;
      text-align: center;
    }
    
    .hidden { display: none; }

    /* Responsive tables for mobile */
    @media (max-width: 768px) {
      .admin-container { padding: 5px; }
      
      /* Forcer les colonnes Bootstrap à prendre toute la largeur sur mobile */
      .row .col-12.col-lg-6,
      .row .col-12.col-lg-8,
      .row .col-12.col-lg-4 {
        width: 100% !important;
        max-width: 100% !important;
        margin-bottom: 15px;
      }
      
      /* Forcer l'empilement vertical des cartes admin */
      .row {
        display: block !important;
      }
      
      /* Réduire les tailles pour optimiser l'espace mobile */
      .btn { 
        width: 100%; 
        padding: 10px 12px; 
        font-size: 0.95em;
        margin: 3px 0;
        border-radius: 6px;
      }
      input, select { 
        padding: 10px; 
        font-size: 0.95em;
      }

      /* Optimisation du tableau d'achat pour mobile */
      .responsive-table { width: 100%; }
      .responsive-table thead { display: none; }
      .responsive-table, .responsive-table tbody, .responsive-table tr, .responsive-table td { display: block; width: 100%; }
      
      /* Compact mobile layout pour les lignes d'achat */
      .responsive-table tr { 
        margin-bottom: 8px; 
        border: 1px solid #333; 
        border-radius: 6px; 
        padding: 8px; 
        background: rgba(0,0,0,0.4);
        position: relative;
      }
      
      /* Style compact pour les cellules du tableau d'achat */
      .responsive-table td { 
        border: none; 
        padding: 4px 0; 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        min-height: unset;
      }
      
      .responsive-table td::before { 
        content: attr(data-label); 
        font-weight: bold; 
        color: #00ff41; 
        margin-right: 8px;
        font-size: 0.85em;
        min-width: 60px;
      }
      
      /* Optimisation spéciale pour le tableau d'achat (#purchase-table) */
      #purchase-table tr {
        margin-bottom: 6px;
        padding: 8px 10px;
        border-radius: 6px;
        display: grid;
        grid-template-columns: 2fr 1fr auto;
        gap: 10px;
        align-items: center;
        background: linear-gradient(90deg, rgba(0,0,0,0.3), rgba(0,0,0,0.5));
        min-height: 50px;
      }
      
      #purchase-table td[data-label="Boisson"] {
        font-weight: bold;
        color: #00ff41;
        font-size: 1.1em;
        padding: 0;
        display: flex;
        align-items: center;
        grid-column: 1;
      }
      
      #purchase-table td[data-label="Boisson"]::before {
        display: none;
      }
      
      #purchase-table td[data-label="Prix Min/Base/Max (€)"] {
        grid-column: 2;
        padding: 4px;
        text-align: center;
        font-size: 0.8em;
      }
      
      #purchase-table td[data-label="Prix Min/Base/Max (€)"]::before {
        content: "Min/Base/Max: ";
        font-weight: bold;
        color: #888;
        display: block;
        margin-bottom: 2px;
      }
      
      #purchase-table td[data-label="Prix Exact (€)"] {
        padding: 8px 4px;
        text-align: center;
      }
      
      #purchase-table td[data-label="Prix Exact (€)"]::before {
        content: "Prix Exact: ";
        font-weight: bold;
        color: #888;
      }
      
      #purchase-table td[data-label="Prix Affiché (€)"] {
        padding: 8px 4px;
        text-align: center;
      }
      
      #purchase-table td[data-label="Prix Affiché (€)"]::before {
        content: "Prix Affiché: ";
        font-weight: bold;
        color: #00ff41;
      }
      
      #purchase-table .current-price {
        color: #00ff41;
        font-weight: bold;
        font-size: 1em;
      }
      
      #purchase-table .next-price {
        color: #888;
        font-size: 0.8em;
        margin-top: 2px;
      }
      
      #purchase-table td[data-label="Actions"] {
        grid-column: 3;
        padding: 0;
        display: flex;
        justify-content: flex-end;
        align-items: center;
      }
      
      #purchase-table td[data-label="Actions"]::before {
        display: none;
      }
      
      #purchase-table .btn {
        padding: 8px 16px;
        font-size: 0.9em;
        margin: 0;
        min-width: 80px;
        border-radius: 6px;
        white-space: nowrap;
      }
      
      /* Réduire l'espacement pour les inputs de prix */
      .price-view, .price-edit {
        font-size: 0.9em;
      }
      
      /* Réduire l'espacement des cartes admin */
      .admin-card {
        padding: 15px;
        margin-bottom: 20px;
        width: 100%;
        box-sizing: border-box;
      }
      
      .admin-card h3 {
        font-size: 1.2em;
        margin-bottom: 12px;
        text-align: center;
        color: rgb(var(--accent));
      }
      
      /* Améliorer la lisibilité des sous-titres */
      .admin-card h5 {
        font-size: 1em;
        margin: 15px 0 8px 0;
        color: rgb(var(--accent));
        border-bottom: 1px solid rgba(var(--accent), 0.3);
        padding-bottom: 5px;
      }
      
      /* Optimiser la zone d'achat pour toutes les bières */
      .admin-card .table-responsive {
        max-height: 80vh; /* Augmenté de 50vh à 80vh pour voir plus de boissons */
        overflow-y: auto;
        border: 1px solid rgba(var(--accent), 0.3);
        border-radius: 6px;
        background: rgba(var(--surface), 0.1);
        padding: 5px;
      }
      
      /* Zone d'historique optimisée */
      .admin-card div[style*="max-height: 400px"] {
        max-height: 40vh !important;
        overflow-y: auto;
        border: 1px solid rgba(var(--accent), 0.3);
        border-radius: 6px;
        background: rgba(var(--surface), 0.1);
        padding: 5px;
      }
      
      /* Indicateur de scroll visuel */
      .admin-card .table-responsive::-webkit-scrollbar {
        width: 6px;
      }
      
      .admin-card .table-responsive::-webkit-scrollbar-track {
        background: rgba(var(--accent), 0.1);
        border-radius: 3px;
      }
      
      .admin-card .table-responsive::-webkit-scrollbar-thumb {
        background: rgba(var(--accent), 0.5);
        border-radius: 3px;
      }
      
      .admin-card .table-responsive::-webkit-scrollbar-thumb:hover {
        background: rgba(var(--accent), 0.7);
      }

      /* Drink management grid stacks vertically on mobile */
      .drinks-form-grid { grid-template-columns: 1fr !important; gap: 8px; }
      
      /* Responsive drinks table */
      .drinks-table-header { display: none; }
      .drinks-table-row { 
        grid-template-columns: 1fr !important;
        gap: 6px;
        border: 1px solid rgba(var(--accent), 0.3);
        border-radius: 6px;
        margin-bottom: 8px;
        background: rgba(var(--surface), 0.5);
        padding: 8px;
      }
      .drinks-table-row input {
        margin-bottom: 4px;
        padding: 6px;
        font-size: 0.9em;
      }
      .drinks-table-row input:before {
        content: attr(data-label);
        display: block;
        font-weight: bold;
        color: rgb(var(--accent));
        margin-bottom: 2px;
        font-size: 0.8em;
      }
      
      /* Style mobile pour le toggle des boissons existantes */
      .drinks-header-toggle {
        padding: 8px 0;
      }
      
      .drinks-header-toggle h5 {
        font-size: 1em;
        margin: 0;
      }
      
      .toggle-icon {
        font-size: 1em;
      }
      
      .drinks-existing-section {
        margin-top: 15px;
      }
      
      /* Prix public en lecture seule sur mobile */
      .public-price {
        background: rgba(var(--accent), 0.15);
        border-radius: 4px;
        border: 1px solid rgba(var(--accent), 0.3);
        font-size: 0.9em !important;
        text-align: center;
      }
      
      /* Optimiser l'historique sur mobile */
      .history-table tr {
        margin-bottom: 8px;
        padding: 8px 10px;
        border-radius: 6px;
        display: block;
        background: rgba(0,0,0,0.4);
        border: 1px solid rgba(var(--accent), 0.2);
      }
      
      .history-table td {
        padding: 4px 0;
        font-size: 0.9em;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: none;
      }
      
      .history-table td::before {
        content: attr(data-label);
        font-weight: bold;
        color: #00ff41;
        font-size: 0.85em;
        min-width: 80px;
      }
      
      /* Style spécial pour les boutons dans l'historique */
      .history-table .btn {
        padding: 4px 8px;
        font-size: 0.8em;
        margin-left: auto;
      }
      
      .history-table .btn-icon {
        min-width: auto;
        padding: 4px 6px;
      }
      
      /* Styles spécifiques pour les prix min/max en version mobile */
      .mobile-price-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        padding: 4px 0;
      }
      
      .min-price {
        color: rgb(var(--up)) !important;
        font-weight: bold;
        font-size: 0.85em;
      }
      
      .max-price {
        color: rgb(var(--down)) !important;
        font-weight: bold;
        font-size: 0.85em;
      }
      
      .alcohol-degree {
        color: rgb(var(--accent));
        font-size: 0.75em;
        font-style: italic;
      }
    }
  </style>
</head>
<body>
  <!-- Formulaire d'authentification -->
  <div id="auth-form" class="auth-form">
    <h1>🔐 Authentification Admin</h1>
    <p>Veuillez vous connecter pour accéder à l'interface d'administration</p>
    <form id="login-form">
      <div class="form-group">
        <label for="username">Nom d'utilisateur :</label>
        <input type="text" id="username" name="username" required>
      </div>
      <div class="form-group">
        <label for="password">Mot de passe :</label>
        <input type="password" id="password" name="password" required>
      </div>
      <button type="submit" class="btn">Se connecter</button>
    </form>
    <div id="auth-message" class="message hidden"></div>
  </div>

  <!-- Interface admin principale -->
  <div id="admin-interface" class="admin-container container hidden">
    <!-- En-tête admin -->
    <div class="admin-header">
      <!-- Zone de contrôles en haut -->
      <div class="admin-controls">
        <!-- Contrôles gauche -->
        <div class="admin-controls-left">
          <div class="theme-controls">
            <label for="admin-theme-select">Thème Interface Principale:</label>
            <select id="admin-theme-select">
              <option value="light">Clair</option>
              <option value="dark">Sombre</option>
            </select>
          </div>
          <div class="chart-toggle">
            <label for="admin-chart-toggle">Graphique:</label>
            <button id="admin-chart-toggle" class="toggle-btn" data-type="candlestick">
              📊 Candlestick
            </button>
          </div>
          <div class="sort-toggle">
            <label for="admin-sort-toggle">Tri:</label>
            <button id="admin-sort-toggle" class="toggle-btn" data-sort="price">
              💰 Prix
            </button>
          </div>
        </div>
        
        <!-- Contrôles droite -->
        <div class="admin-controls-right">
          <span class="status-indicator" id="connection-status"></span>
          <span id="connection-text">Connexion...</span>
          <a href="index.html" class="btn btn-secondary admin-back-btn">← Retour au mur</a>
          <button onclick="logout()" class="btn btn-danger admin-logout-btn">Déconnexion</button>
        </div>
      </div>
      
      <h1>🔧 Interface Administrateur</h1>
      <p>Gestion du marché des boissons en temps réel</p>
      
      <!-- Message d'avertissement sans session -->
      <div id="global-session-warning" class="message warning hidden" style="margin: 20px 0; border: 2px solid #FF9800; background: linear-gradient(45deg, #FFF8DC, #FFFACD);">
        <h4 style="margin: 0 0 10px 0; color: #E65100; display: flex; align-items: center; gap: 8px;">
          🚫 Session Requise
        </h4>
        <p style="margin: 0; color: #BF360C;">
          <strong>La plupart des fonctions admin nécessitent une session active.</strong><br>
          Veuillez démarrer une session ci-dessous pour accéder aux contrôles du marché, achats, historique et gestion des boissons.
        </p>
      </div>
      
      <!-- Section Gestion Session -->
      <div id="session-section" style="margin: 20px 0; padding: 15px; border: 2px solid rgb(var(--accent)); border-radius: 8px; background: rgba(var(--surface), 0.9);">
        <h3 style="margin: 0 0 15px 0; color: rgb(var(--accent)); display: flex; align-items: center; gap: 8px;">
          💼 Session de Service
        </h3>
        
        <!-- Indicateur de session -->
        <div id="session-status" style="margin-bottom: 15px;">
          <div id="no-session" class="session-state">
            <p style="color: #999; margin: 0;">❌ Aucune session active</p>
            <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; align-items: end;">
              <div style="flex: 1; min-width: 150px;">
                <label for="barmanName" style="display: block; margin-bottom: 5px; color: rgb(var(--accent)); font-weight: 600;">Nom du barman :</label>
                <input type="text" id="barmanName" placeholder="Nom du barman" style="width: 100%; padding: 8px 12px; border: 1px solid rgba(var(--grid), 0.5); border-radius: 6px; background: rgba(var(--surface), 0.8);">
              </div>
              <div style="min-width: 120px;">
                <label for="startingCash" style="display: block; margin-bottom: 5px; color: rgb(var(--accent)); font-weight: 600;">Caisse départ (€) :</label>
                <input type="number" id="startingCash" value="0" min="0" step="0.01" style="width: 100%; padding: 8px 12px; border: 1px solid rgba(var(--grid), 0.5); border-radius: 6px; background: rgba(var(--surface), 0.8);">
              </div>
              <button onclick="startSession()" class="btn" style="background: linear-gradient(45deg, #4CAF50, #45a049);">
                🚀 Démarrer Session
              </button>
              <button onclick="resumeSession()" class="btn btn-warning">
                🔄 Reprendre Session
              </button>
            </div>
          </div>
          
          <div id="active-session" class="session-state hidden">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
              <div class="stat-card">
                <div class="stat-value" id="session-revenue" style="color: #4CAF50;">0.00 €</div>
                <div class="stat-label">Chiffre d'Affaires</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="session-profit" style="color: #FF9800;">0.00 €</div>
                <div class="stat-label">Bénéfice/Perte</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="session-drinks" style="color: rgb(var(--accent));">0</div>
                <div class="stat-label">Boissons Vendues</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="session-duration" style="color: #666;">00:00</div>
                <div class="stat-label">Durée</div>
              </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <div>
                <strong style="color: rgb(var(--accent));">Barman:</strong> <span id="session-barman">-</span><br>
                <strong style="color: rgb(var(--accent));">Démarrée:</strong> <span id="session-start">-</span>
              </div>
              <button onclick="endSession()" class="btn btn-danger">
                🏁 Terminer Session
              </button>
            </div>
            
            <div style="font-size: 0.9em; color: #999;">
              💾 Session sauvegardée automatiquement
            </div>
          </div>
        </div>
      </div>
      
      <!-- Boutons d'événements marché -->
      <div class="require-session" style="margin: 20px 0; text-align: center; position: relative;">
        <h3 style="margin-bottom: 15px;">📉 CRASH du Marché</h3>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px;">
          <button onclick="triggerMarketCrash('small')" class="btn btn-warning" style="background: linear-gradient(45deg, #FF9800, #F57C00);">
            📉 Petit Crash (-5% à -15%)
          </button>
          <button onclick="triggerMarketCrash('medium')" class="btn btn-danger">
            📉 Crash Moyen (-10% à -30%)
          </button>
          <button onclick="triggerMarketCrash('large')" class="btn btn-danger" style="background: linear-gradient(45deg, #D32F2F, #B71C1C);">
            📉 Gros Crash (-20% à -50%)
          </button>
          <button onclick="triggerMarketCrash('maximum')" class="btn btn-danger" style="background: linear-gradient(45deg, #B71C1C, #8B0000); animation: pulse 2s infinite;">
            � CRASH MAXIMAL (Prix Min)
          </button>
        </div>
        
        <h3 style="margin-bottom: 15px;">📈 BOOM du Marché</h3>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
          <button onclick="triggerMarketBoom('small')" class="btn" style="background: linear-gradient(45deg, #8BC34A, #689F38);">
            📈 Petit Boom (+5% à +15%)
          </button>
          <button onclick="triggerMarketBoom('medium')" class="btn" style="background: linear-gradient(45deg, #4CAF50, #388E3C);">
            📈 Boom Moyen (+10% à +30%)
          </button>
          <button onclick="triggerMarketBoom('large')" class="btn" style="background: linear-gradient(45deg, #2E7D32, #1B5E20);">
            📈 Gros Boom (+20% à +50%)
          </button>
          <button onclick="triggerMarketBoom('maximum')" class="btn" style="background: linear-gradient(45deg, #1B5E20, #0D4F0D); animation: pulse 2s infinite;">
            🚀 BOOM MAXIMAL (Prix Max)
          </button>
        </div>
        
        <!-- Happy Hour intégré dans les contrôles marché -->
        <div style="margin-top: 25px; padding: 15px; border: 2px solid #FFD700; border-radius: 8px; background: linear-gradient(45deg, #FFF8DC, #FFFACD);">
          <h4 style="margin: 0 0 15px 0; color: #B8860B; display: flex; align-items: center; gap: 8px;">
            🍺 Happy Hour !
          </h4>
          <div class="market-controls" style="display: flex; gap: 15px; align-items: end; flex-wrap: wrap; margin-bottom: 15px;">
            <div style="flex: 1; min-width: 200px;">
              <label for="happyHourDrinkSelect" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Boisson :</label>
              <select id="happyHourDrinkSelect" style="width: 100%; padding: 8px 12px; border: 2px solid #FFD700; border-radius: 6px; background: white; font-size: 14px;">
                <option value="">🍺 Sélectionner une boisson...</option>
              </select>
            </div>
            <div style="min-width: 120px;">
              <label for="happyHourDuration" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Durée (sec) :</label>
              <input type="number" id="happyHourDuration" value="300" min="10" max="7200" style="width: 100%; padding: 8px 12px; border: 2px solid #FFD700; border-radius: 6px; font-size: 14px;">
            </div>
            <button onclick="startHappyHour()" class="btn" style="background: linear-gradient(45deg, #FFD700, #FFA500); color: #333; font-weight: 600; border: 2px solid #FF8C00; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
              🌟 Lancer Happy Hour
            </button>
            <button onclick="stopAllHappyHours()" class="btn" style="background: linear-gradient(45deg, #FF6B6B, #FF5252); color: white; font-weight: 600;">
              🛑 Arrêter Toutes
            </button>
          </div>
          
          <!-- Liste des Happy Hours actives -->
          <div id="active-happy-hours" style="border: 1px solid #DAA520; border-radius: 6px; padding: 10px; background: rgba(255, 255, 255, 0.5);">
            <h5 style="margin: 0 0 8px 0; color: #B8860B;">🌟 Happy Hours Actives :</h5>
            <div id="happy-hours-list">
              <p style="color: #666; font-style: italic; margin: 0; font-size: 0.9em;">Aucune Happy Hour active</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sections accordéon pour l'interface admin -->
    <div class="accordion-container">
      
      <!-- Section 1: Enregistrer un achat -->
      <div class="admin-section require-session">
        <div class="section-header" onclick="toggleSection('purchase-section')">
          <h3>🛒 Enregistrer un achat</h3>
          <span class="toggle-icon" id="purchase-toggle">▼</span>
        </div>
        <div class="section-content" id="purchase-section">
          <div class="table-responsive">
            <table id="purchase-table" class="responsive-table" style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr>
                  <th>Boisson</th>
                  <th>Prix Min/Base/Max (€)</th>
                  <th>Prix Exact (€)</th>
                  <th>Prix Affiché (€)</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Les boissons seront chargées dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="buy-message" class="message hidden"></div>
        </div>
      </div>

      <!-- Section 2: Historique des transactions -->
      <div class="admin-section require-session">
        <div class="section-header" onclick="toggleSection('history-section')">
          <h3>📈 Historique des transactions</h3>
          <span class="toggle-icon" id="history-toggle">▼</span>
        </div>
        <div class="section-content" id="history-section">
          <div id="history-message" class="message hidden" style="margin-bottom: 10px;"></div>
          <div class="mb-2">
            <button onclick="clearHistory()" class="btn btn-danger btn-icon" title="Supprimer tout l'historique" aria-label="Supprimer tout l'historique">🗑️</button>
            <span style="margin-left: 15px; color: #888;">
              Dernière mise à jour: <span id="last-update">--</span>
            </span>
          </div>
          <div class="table-container">
            <table class="history-table responsive-table" id="history-table">
              <thead>
                <tr>
                  <th>Heure</th>
                  <th>Boisson</th>
                  <th>Prix</th>
                  <th>Variation</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="history-tbody">
                <!-- L'historique sera chargé dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Section 3: Gestion des boissons -->
      <div class="admin-section require-session">
        <div class="section-header" onclick="toggleSection('drinks-section')">
          <h3>🍺 Gestion des boissons</h3>
          <span class="toggle-icon" id="drinks-toggle">▼</span>
        </div>
        <div class="section-content" id="drinks-section">
          <!-- Formulaire d'ajout -->
          <div class="drinks-form-container">
            <div id="session-warning" class="message warning hidden" style="margin-bottom: 15px;">
              ⚠️ Une session doit être active pour ajouter des boissons. Veuillez démarrer une session dans l'onglet "Session".
            </div>
            <div class="drinks-form-grid" id="add-drink-form">
              <div class="form-group">
                <label for="new-drink-name">Nom de la boisson</label>
                <input type="text" id="new-drink-name" placeholder="Ex: Bière Stella">
              </div>
              <div class="form-group">
                <label for="new-drink-base">Prix de base (€)</label>
                <input type="number" id="new-drink-base" step="0.01" min="0" placeholder="5.00">
              </div>
              <div class="form-group">
                <label for="new-drink-min">Prix min (€)</label>
                <input type="number" id="new-drink-min" step="0.01" min="0" placeholder="1.00">
              </div>
              <div class="form-group">
                <label for="new-drink-max">Prix max (€)</label>
                <input type="number" id="new-drink-max" step="0.01" min="0" placeholder="10.00">
              </div>
              <div style="display: flex; gap: 10px;">
                <button onclick="addDrink()" class="btn" id="add-drink-btn">Ajouter</button>
              </div>
            </div>
            <div id="add-drink-message" class="message hidden"></div>
          </div>

          <!-- Liste des boissons existantes -->
          <div class="drinks-table-container">
            <div class="drinks-header-toggle" onclick="toggleDrinksTable()">
              <span><strong>📋 Liste des boissons existantes</strong></span>
              <span class="toggle-icon" id="drinks-table-toggle">▼</span>
            </div>
            <div id="drinks-table-content" class="collapse show" style="display: none;">
              <div class="drinks-table-header">
                <div>Nom</div>
                <div>Prix min</div>
                <div>Prix base</div>
                <div>Prix max</div>
                <div>Prix public</div>
                <div>Actions</div>
              </div>
              <div id="drinks-admin-list"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 4: Intervalle d'actualisation -->
      <div class="admin-section require-session">
        <div class="section-header" onclick="toggleSection('interval-section')">
          <h3>⏱️ Intervalle d'actualisation</h3>
          <span class="toggle-icon" id="interval-toggle">▼</span>
        </div>
        <div class="section-content" id="interval-section">
        <form id="refresh-interval-form">
          <div class="form-group">
            <label for="refresh-interval">Intervalle de rafraîchissement des prix (secondes)</label>
            <input type="number" id="refresh-interval" min="0" step="1" placeholder="30">
            <small style="color: #888; display: block; margin-top: 5px;">
              0 = mode manuel (pas d'actualisation automatique)
            </small>
          </div>
          <button type="submit" class="btn">Mettre à jour l'intervalle</button>
          <div id="interval-message" class="message hidden"></div>
        </form>
          
          <!-- Affichage de l'état actuel -->
          <div style="margin-top: 20px; padding: 15px; background: rgba(var(--surface), 0.5); border-radius: 8px;">
            <h4>État actuel :</h4>
            <p>Intervalle : <span id="current-interval">--</span> secondes</p>
            <p>Prochaine actualisation : <span id="admin-timer">--</span></p>
            <p>Timer actif depuis : <span id="timer-start">--</span></p>
          </div>
        </div>
      </div>

    </div>

    <!-- Lien vers l'interface publique -->
    <div style="text-align: center; margin-top: 30px;">
      <a href="/" class="btn" style="text-decoration: none; display: inline-block;">
        👁️ Voir l'Interface Publique
      </a>
    </div>

    <!-- Sélecteur de thème (2 thèmes: Clair / Sombre) -->
    <div id="theme-controls" class="theme-controls d-inline-flex align-items-center gap-2 mt-3" style="justify-content:center;">
      <label for="theme-select" class="mb-0" style="opacity: 0.9;">Thème Admin:</label>
      <select id="theme-select" class="form-select form-select-sm" style="background: transparent; color: inherit; border: 1px solid currentColor; padding: 6px 10px; border-radius: 8px; width: auto; margin-left:8px;">
          <option value="light">Clair</option>
          <option value="dark">Sombre</option>
      </select>
    </div>
  </div>

  <script src="admin.js"></script>
</body>
</html>
